var v="M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,14.19 21.84,15.8 21.56,16.83C21.31,17.73 20.73,18.31 19.83,18.56C19.36,18.69 18.5,18.78 17.18,18.84C15.88,18.91 14.69,18.94 13.59,18.94L12,19C7.81,19 5.2,18.84 4.17,18.56C3.27,18.31 2.69,17.73 2.44,16.83C2.31,16.36 2.22,15.73 2.16,14.93C2.09,14.13 2.06,13.44 2.06,12.84L2,12C2,9.81 2.16,8.2 2.44,7.17C2.69,6.27 3.27,5.69 4.17,5.44C4.64,5.31 5.5,5.22 6.82,5.16C8.12,5.09 9.31,5.06 10.41,5.06L12,5C16.19,5 18.8,5.16 19.83,5.44C20.73,5.69 21.31,6.27 21.56,7.17Z";function L(s){const{selection:e}=s.state;if(e.node)return e.node;const{$anchor:t}=e;return t.parent}function x(s){return FPRichEditor.tiptap.Node.create({name:"oembed",group:"block",draggable:!0,atom:!0,addAttributes(){return{src:{default:null},title:{default:""},provider:{default:""}}},parseHTML(){return[{tag:"oembed[src]",getAttrs:e=>({src:e.getAttribute("src"),title:e.getAttribute("title"),provider:e.getAttribute("provider")})}]},renderHTML({HTMLAttributes:e}){return["oembed",e]},addNodeView(){return({node:e,editor:t})=>{const o=document.createElement("div");o.classList.add("oembed-preview");const i=document.createElement("h5");i.textContent=(e.attrs.provider||"Unknown provider")+" embed",o.appendChild(i);const n=document.createElement("span");return n.textContent=e.attrs.title?e.attrs.title:e.attrs.src,o.appendChild(n),o.addEventListener("dblclick",r=>{s.component.openModal("oembed-dialog",{src:e.attrs.src})}),{dom:o,contentDOM:null}}},addCommands(){return{insertOembed:e=>({commands:t})=>t.insertContent({type:this.name,attrs:e}),removeOembed:e=>({commands:t})=>this.options.levels.includes(e.level)?t.toggleNode(this.name,"paragraph",e):!1}}})}window.FPRichEditor.registerPlugin("oembed",{buttons(){return[{name:"oembed",icon:v,label:"Embed content from another site",active:"oembed",action:function(s,e){let t=L(s),o=null;t&&t.type.name==="oembed"&&t.attrs.src&&(o=t.attrs.src),e.openModal("oembed-dialog",{src:o})}}]},onPaste(s,e,t){let i=s.clipboardData.getData("text/plain").trim().split(`
`),n=[];i.forEach(r=>{if(r=r.trim(),n.indexOf(r)===-1)try{let a=new URL(r);n.push(r)}catch{}}),n.length&&this.component.requestFromServer("parseOembedLinks",{urls:n}).then(r=>{if(typeof r.results!="object"||Object.keys(r.results).length===0)return;let a={};const{state:p,view:b}=t,c=p.tr;for(let l in r.results){let d=r.results[l],u=E(t,l);console.log(d),u.length&&u.forEach(({node:h,pos:m})=>{let f=t.schema.nodes.oembed.create({src:d.url,provider:d.provider,title:d.title});const C=m,g=m+h.nodeSize;c.replaceWith(C,g,f)})}c.docChanged&&b.dispatch(c),console.log(a,r)})},tiptap:function(){return x(this)}});function E(s,e){const{state:t,view:o}=s;let i=[];return t.doc.descendants((n,r)=>{n.type.name==="paragraph"&&n.textContent.trim()===e&&i.push({node:n,pos:r})}),i}
