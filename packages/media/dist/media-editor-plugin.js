var a="M9 13V5C9 3.9 9.9 3 11 3H20C21.1 3 22 3.9 22 5V11H18.57L17.29 9.26C17.23 9.17 17.11 9.17 17.05 9.26L15.06 12C15 12.06 14.88 12.07 14.82 12L13.39 10.25C13.33 10.18 13.22 10.18 13.16 10.25L11.05 12.91C10.97 13 11.04 13.15 11.16 13.15H17.5V15H11C9.89 15 9 14.11 9 13M6 22V21H4V22H2V2H4V3H6V2H8.39C7.54 2.74 7 3.8 7 5V13C7 15.21 8.79 17 11 17H15.7C14.67 17.83 14 19.08 14 20.5C14 21.03 14.11 21.53 14.28 22H6M4 7H6V5H4V7M4 11H6V9H4V11M4 15H6V13H4V15M6 19V17H4V19H6M23 13V15H21V20.5C21 21.88 19.88 23 18.5 23S16 21.88 16 20.5 17.12 18 18.5 18C18.86 18 19.19 18.07 19.5 18.21V13H23Z";var A={};window.FPRichEditor.registerPlugin("media",{buttons(){return[{name:"media",icon:a,label:"Insert/Create Media",active:"media",action:function(C){this.plugin.openBrowser(C)}}]},onPaste(C,H,L){},makeMediaNode:function(){},getSelectedNode:function(){let C=this.editor.state.selection;return C.node?C.node:C.$anchor.parent},isSelectedNodeAtEnd:function(){let C=this.editor,H=C.state.selection,L=C.state.doc,V=this.getSelectedNode();return V?H.$anchor.start()+V.nodeSize===L.content.size:!1},openBrowser:function(){let C=this.editor,H=C.state,L=C.view,V=H.selection,M=this.getSelectedNode(C),r={};M&&M.type.name==="media"&&M.attrs.media&&(r=M.attrs,r["data-preview"]&&delete r["data-preview"]);let t=this;window.FPMediaBrowser.show().inline().selected(r?.media).attributes(r).collection(this.config.collection).then(i=>{if(i?.length&&C.commands.insertMedia(i[0]),t.isSelectedNodeAtEnd()){let{$anchor:e}=V,o=e.end();C.chain().focus().insertContentAt(o,"<p></p>").run();let d=o+1;C.commands.setTextSelection(d)}else{let e=C.state.selection.$to.pos;C.commands.setTextSelection(e+1),C.chain().focus().run()}L.focus()})},tiptap:function(){let C=this;return FPRichEditor.tiptap.Node.create({name:"media",group:"block",draggable:!0,atom:!1,addAttributes(){return{media:{default:null},alt:{default:""},link:{default:""},"data-preview":{default:""},caption:{default:null,parseHTML:H=>H.textContent},align:{default:""}}},parseHTML(){return[{tag:"fp-media[media]",getAttrs:H=>{let L=H.getAttribute("data-preview"),V=H.getAttribute("media");return L&&V&&(A[V]=L),{media:H.getAttribute("media")}}}]},renderHTML({HTMLAttributes:H}){let L={...H};return Object.keys(L).includes("data-preview")&&delete L["data-preview"],Object.keys(L).forEach(V=>{L[V]||delete L[V]}),["fp-media",L,L.caption||""]},addNodeView(){return({node:H,editor:L})=>{let V=document.createElement("div"),M=A[H.attrs.media];return M?(V.innerHTML=M,V=V.firstElementChild):V.innerText="Invalid media",V.classList.add("fp-media-node"),V.addEventListener("dblclick",r=>{C.openBrowser()}),{dom:V,contentDOM:null}}},addCommands(){return{insertMedia:H=>({commands:L,tr:V,editor:M})=>{H["data-preview"]&&H.media&&(A[H.media]=H["data-preview"],delete H["data-preview"]);let{from:r}=V.selection,t=L.insertContent({type:this.name,attrs:H});return!0}}}})}});
